# 정규화 패턴별 통계 확인 실행 순서

## 📋 실행 순서

### 1단계: 스키마 업데이트

```bash
# match_type, match_keyword 컬럼 추가
psql -U postgres -d clinicaltrials -f update_schema.sql
```

또는 Python으로 실행:

```python
# update_schema.sql 파일의 SQL을 실행
```

### 2단계: 정규화 재실행

```bash
# normalize_phase1.py 실행하여 match_type 데이터 채우기
python normalize_phase1.py
```

이 스크립트는:

- `outcome_raw` 테이블의 데이터를 읽어서
- Dictionary 매칭을 수행하고
- `match_type`을 설정합니다:
  - `MEASURE_CODE`: measure_code 직접 매칭
  - `ABBREVIATION`: 약어(abbreviation) 매칭
  - `KEYWORD`: 키워드 매칭
  - `CANONICAL_NAME`: 정식 이름 매칭

### 3단계: 성공/실패 분리

```bash
# outcome_normalized_success와 outcome_normalized_failed로 분리
python separate_normalized_data.py
```

### 4단계: 패턴별 통계 확인

```bash
# 정규화 패턴별 통계 쿼리 실행
psql -U postgres -d clinicaltrials -f query_normalization_patterns.sql
```

## ⚠️ 주의사항

- **반드시 순서대로 실행**해야 합니다.
- `match_type` 컬럼이 없으면 `query_normalization_patterns.sql` 실행 시 에러가 발생합니다.
- 정규화를 재실행하면 기존 `outcome_normalized` 테이블의 데이터가 **덮어씌워**집니다.

## 📊 확인할 수 있는 통계

1. **매칭 타입별 통계**: MEASURE_CODE, ABBREVIATION, KEYWORD, CANONICAL_NAME별 분포
2. **파싱 방법별 통계**: RULE_BASED vs LLM 비교
3. **실패 원인별 통계**: MEASURE_FAILED, TIMEFRAME_FAILED, BOTH_FAILED
4. **Domain별 통계**: 각 Domain의 measure_code 분포
5. **Time Frame 패턴별 통계**: time_unit, change_from_baseline 등
6. **종합 패턴 매트릭스**: 여러 차원의 교차 분석

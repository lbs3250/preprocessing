# 2025-12-17 작업 내역

## 개요
Outcome 데이터 정규화 결과 분석 및 통계 보고서 생성 작업을 수행했습니다.

---

## 주요 작업 내용

### 1. 완전히 성공한 Study 개수 로깅 스크립트 개발

**파일**: `log_complete_success_studies.py`

**목적**: 
- 성공 테이블(`outcome_normalized_success`)에 있는 nct_id 중에서
- 실패 테이블(`outcome_normalized_failed`)에 없는 nct_id의 개수를 조회
- 즉, 모든 outcome이 성공한 study를 식별

**주요 기능**:
- 기본 통계 조회
  - 완전히 성공한 Study 개수
  - 성공 테이블의 전체 Study 개수
  - 실패 테이블의 전체 Study 개수
  - 전체 Study 개수
  - 성공 테이블 내 완전 성공 비율
  - 전체 Study 대비 완전 성공 비율

- 카테고리별 통계 조회
  - 완전히 성공한 Study
  - 일부 성공한 Study (일부 실패 포함)
  - 완전히 실패한 Study

- 로그 파일 자동 저장
  - 타임스탬프가 포함된 파일명으로 저장
  - 형식: `log_complete_success_studies_YYYYMMDD_HHMMSS.txt`

**실행 결과** (2025-12-17 16:57:45, 16:58:13):
```
완전히 성공한 Study 개수: 669건
성공 테이블의 전체 Study 개수: 1,151건
실패 테이블의 전체 Study 개수: 701건
전체 Study 개수: 1,370건

성공 테이블 내 완전 성공 비율: 58.12%
전체 Study 대비 완전 성공 비율: 48.83%

[카테고리별 통계]
완전히 성공한 Study: 669건 (48.83%)
일부 성공한 Study (일부 실패 포함): 482건 (35.18%)
완전히 실패한 Study: 219건 (15.99%)

합계: 1,370건
```

---

### 2. 통계 보고서 생성 스크립트 개발

**파일**: `generate_statistics_report.py`

**목적**: 
- Outcome 데이터 정규화 결과를 계층적으로 분석
- Markdown 형식의 통계 보고서 자동 생성

**주요 기능**:
- 계층적 통계 조회
  - NCTID 기준 통계
  - Outcome 기준 통계
  - Primary/Secondary 기준 통계
  - Phase 기준 통계

- 보고서 생성
  - 콘솔 출력
  - Markdown 파일 저장
  - 타임스탬프가 포함된 파일명: `statistics_report_YYYYMMDD_HHMMSS.md`

**생성된 보고서**: `md/statistics_report_20251217_151025.md`

**주요 통계 결과**:

#### NCTID 기준
- 전체 Study: 1,370건
- 완전히 성공한 Study: 669건 (48.83%)
- 일부 성공한 Study: 482건 (35.18%)
- 완전히 실패한 Study: 219건 (15.99%)

#### Outcome 기준
- 전체 Outcome: 9,030건
- 성공: 6,861건 (75.98%)
- 실패: 2,169건 (24.02%)
  - MEASURE_FAIL: 1,647건 (18.24%)
  - TIME_FAIL: 391건 (4.33%)
  - BOTH_FAIL: 131건 (1.45%)

#### Primary/Secondary 기준
- Primary Outcome
  - 성공: 2,280건 (74.07%)
  - 실패: 798건 (25.93%)
- Secondary Outcome
  - 성공: 4,581건 (76.97%)
  - 실패: 1,371건 (23.03%)

#### Phase 기준
- PHASE1: 성공률 81.26%
- PHASE2: 성공률 76.59%
- PHASE3: 성공률 75.59%
- PHASE4: 성공률 60.85%
- NA: 성공률 68.30%

---

### 3. SQL 쿼리 작성

**파일**: `sql/query_complete_success_studies.sql`

**내용**:
- 완전히 성공한 Study 개수 조회 쿼리
- 카테고리별 상세 통계 쿼리
- 성공/실패 테이블 간 교집합/차집합 연산 활용

---

## 생성된 파일

### Python 스크립트
1. `log_complete_success_studies.py` - 완전히 성공한 Study 개수 로깅 스크립트

### SQL 쿼리
1. `sql/query_complete_success_studies.sql` - 완전히 성공한 Study 조회 쿼리

### 로그 파일
1. `log_complete_success_studies_20251217_165745.txt`
2. `log_complete_success_studies_20251217_165813.txt`

### 보고서 파일
1. `md/statistics_report_20251217_151025.md` - 계층적 통계 보고서

---

## 주요 인사이트

### 1. Study 단위 성공률
- 전체 1,370개 Study 중 669개(48.83%)가 완전히 성공
- 482개(35.18%)는 일부 성공/일부 실패 혼재 상태
- 219개(15.99%)는 완전히 실패

### 2. Outcome 단위 성공률
- 전체 9,030개 Outcome 중 6,861개(75.98%)가 성공
- 실패 원인별 분석:
  - Measure 정규화 실패가 가장 많음 (1,647건, 18.24%)
  - Timeframe 정규화 실패 (391건, 4.33%)
  - 둘 다 실패 (131건, 1.45%)

### 3. Phase별 성공률
- Phase가 명확한 경우 성공률이 높음 (75-81%)
- Phase4의 성공률이 상대적으로 낮음 (60.85%)
- Phase 정보가 없는 경우(NA) 성공률이 낮아짐 (68.30%)

---

## 향후 작업 계획

1. **실패 케이스 분석**
   - Measure 정규화 실패 케이스 심층 분석
   - Timeframe 정규화 실패 케이스 심층 분석
   - 실패 패턴 파악 및 정규식 개선

2. **데이터 품질 개선**
   - Phase 정보 누락 데이터 처리 방안 검토
   - 일부 성공/일부 실패 Study의 실패 원인 분석

3. **보고서 고도화**
   - Sponsor별 통계 추가
   - 시간대별 추이 분석
   - 시각화 차트 추가

---

## 기술 스택

- **언어**: Python 3.x
- **데이터베이스**: PostgreSQL
- **라이브러리**: 
  - `psycopg2` - PostgreSQL 연결
  - `pandas` - 데이터 처리
  - `python-dotenv` - 환경변수 관리

---

## 실행 방법

### 완전히 성공한 Study 개수 로깅
```bash
python log_complete_success_studies.py
```

### 통계 보고서 생성
```bash
python generate_statistics_report.py
```

---

## 참고 파일

- `separate_normalized_data.py` - 정규화 데이터 분리 스크립트
- `normalize_phase1.py` - Outcome 데이터 정규화 스크립트
- `md/statistics_report_20251217_151025.md` - 상세 통계 보고서







